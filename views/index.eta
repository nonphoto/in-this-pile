<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>In This Pile</title>
    <link rel="stylesheet" href="/index.css" />
    <script type="module">
      import "/socket.io/socket.io.js";
      import S from "/s.js";

      const clicksElement = document.getElementById("clicks");
      const scrollElement = document.getElementById("scroll");
      const clockElement = document.getElementById("clock");

      const socket = io();
      socket.on("clicks", (clicks) => {
        clicksElement.textContent = clicks;
      });
      socket.on("scroll", (scroll) => {
        scrollElement.textContent = scroll;
      });

      const windowSize = S.data([window.innerWidth, window.innerHeight]);
      window.addEventListener("resize", () => {
        windowSize([window.innerWidth, window.innerHeight]);
      });

      S.root(() => {
        const angle = -Math.PI / 2;
        Array.from(clockElement.children).map((child, index) => {
          S(() => {
            const [width, height] = windowSize();
            const a = angle + (index * Math.PI) / 4;
            const x = (Math.cos(a) * width) / 2.1;
            const y = (Math.sin(a) * height) / 2.1;
            const px = Math.cos(a) * -50 - 50;
            const py = Math.sin(a) * -50 - 50;
            child.style.transform = `translate(${x}px, ${y}px)  translate(${px}%, ${py}%)`;
          });
        });
      });
    </script>
  </head>
  <body>
    <p id="date"><%= it.hours %>:<%= it.minutes %>:<%= it.seconds %></p>
    <p id="clicks"><%= it.clicks %></p>
    <p id="scroll"><%= it.scroll %></p>
    <div id="clock">
      <p>Tell us about the passing of time,</p>
      <p>in this room:</p>
      <p>our fruiting body</p>
      <p>bursts forth,</p>
      <p>life stands in place, covered,</p>
      <p>like a mouse</p>
      <p>or a mushroom</p>
    </div>
    <div id="posts">
      <div>
        <p>
          In This Pile is a response to our accelerationist behavior, a space to
          question how we spend time with other forms of life and eachother. It
          is a compost pile in a small room. It’s mycelium, metal and plastic.
          Spores and projected pixels. It’s a body and mind. It’s growth and
          decay. Lines entwined. It’s space to care. A room to pause (time) in.
          It’s now but it’s not.
        </p>
      </div>
      <% it.posts.reverse().forEach((post) => { %>
      <div>
        <h2><%= post.title %></h2>
        <p><%= post.body %></p>
      </div>
      <% }) %>
    </div>
  </body>
</html>
